import unittest

import mnt.pyfiction
from mnt.pyfiction import (
    charge_distribution_surface_100,
    color_mode,
    sidb_100_lattice,
    sidb_charge_state,
    sidb_technology,
    write_sidb_layout_svg_params,
    write_sidb_layout_svg_to_string,
)


def normalize_svg(svg: str) -> str:
    """
    Normalizes an SVG string by removing all whitespace, including spaces, tabs, and newlines.

    This function takes an SVG string as input and returns a new string with all
    whitespace characters removed. This can be useful for comparing SVG strings
    or reducing the size for transmission.

    Parameters:
    svg (str): The input SVG string to be normalized.

    Returns:
    str: A string with all whitespace characters removed.
    """
    # Remove all whitespace (spaces, tabs, newlines)
    return "".join(svg.split())


cell_level_dark_mode = (
    """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Generated by """
    + mnt.pyfiction.__version__
    + " "
    + "("
    + mnt.pyfiction.__repo__
    + ")"
    + """ -->
<svg
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 19.2 23.04"
    version="1.1">
    <metadata>
        <rdf:RDF>
            <cc:Work rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
            </cc:Work>
        </rdf:RDF>
    </metadata>

<defs>
    <!-- lattice point -->
    <circle id="lattice_point" cx="0" cy="0" r="0.3"/>
    <!-- SiDB -->
    <circle id="sidb_color" cx="0" cy="0" r="0.9"/>
</defs>
 <!-- PATH_DEFINITION placeholder -->
    <rect x="0" y="0" width="19.2" height="23.04" style="fill:#25323D;"/> <!-- Background rectangle placeholder -->
    <g>
        <use xlink:href="#lattice_point" x="3.84" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="17.61" style="fill:#6e7175;"/><use xlink:href="#sidb_color" x="3.84" y="7.68" style="fill:#C8C8C8; fill-opacity:1; stroke:#ffffff; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="7.68" style="fill:#C8C8C8; fill-opacity:1; stroke:#ffffff; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="9.93" style="fill:#C8C8C8; fill-opacity:1; stroke:#ffffff; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="15.36" y="17.61" style="fill:#C8C8C8; fill-opacity:1; stroke:#ffffff; stroke-width:0.3;"/> <!-- SVG content placeholder -->
    </g>
</svg>"""
)

cell_level_light_mode = (
    """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Generated by """
    + mnt.pyfiction.__version__
    + " "
    + "("
    + mnt.pyfiction.__repo__
    + ")"
    + """ -->
<svg
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 19.2 23.04"
    version="1.1">
    <metadata>
        <rdf:RDF>
            <cc:Work rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
            </cc:Work>
        </rdf:RDF>
    </metadata>

<defs>
    <!-- lattice point -->
    <circle id="lattice_point" cx="0" cy="0" r="0.3"/>
    <!-- SiDB -->
    <circle id="sidb_color" cx="0" cy="0" r="0.9"/>
</defs>
 <!-- PATH_DEFINITION placeholder -->
    <rect x="0" y="0" width="19.2" height="23.04" style="fill:#ffffff;"/> <!-- Background rectangle placeholder -->
    <g>
        <use xlink:href="#lattice_point" x="3.84" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="17.61" style="fill:#6e7175;"/><use xlink:href="#sidb_color" x="3.84" y="7.68" style="fill:#ffffff; fill-opacity:1; stroke:#C8C8C8; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="7.68" style="fill:#ffffff; fill-opacity:1; stroke:#C8C8C8; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="9.93" style="fill:#ffffff; fill-opacity:1; stroke:#C8C8C8; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="15.36" y="17.61" style="fill:#ffffff; fill-opacity:1; stroke:#C8C8C8; stroke-width:0.3;"/> <!-- SVG content placeholder -->
    </g>
</svg>"""
)

cds_dark_mode = (
    """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Generated by """
    + mnt.pyfiction.__version__
    + " "
    + "("
    + mnt.pyfiction.__repo__
    + ")"
    + """ -->
<svg
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 19.2 23.04"
    version="1.1">
    <metadata>
        <rdf:RDF>
            <cc:Work rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
            </cc:Work>
        </rdf:RDF>
    </metadata>

<defs>
    <!-- lattice point -->
    <circle id="lattice_point" cx="0" cy="0" r="0.3"/>
    <!-- SiDB -->
    <circle id="sidb_color" cx="0" cy="0" r="0.9"/>
</defs>
 <!-- PATH_DEFINITION placeholder -->
    <rect x="0" y="0" width="19.2" height="23.04" style="fill:#25323D;"/> <!-- Background rectangle placeholder -->
    <g>
        <use xlink:href="#lattice_point" x="3.84" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="17.61" style="fill:#6e7175;"/><use xlink:href="#sidb_color" x="3.84" y="7.68" style="fill:#00ADAE; fill-opacity:1; stroke:#00ADAE; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="7.68" style="fill:#C8C8C8; fill-opacity:0; stroke:#ffffff; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="9.93" style="fill:#00ADAE; fill-opacity:1; stroke:#00ADAE; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="15.36" y="17.61" style="fill:#E34857; fill-opacity:1; stroke:#E34857; stroke-width:0.3;"/> <!-- SVG content placeholder -->
    </g>
</svg>"""
)

cds_light_mode = (
    """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Generated by """
    + mnt.pyfiction.__version__
    + " "
    + "("
    + mnt.pyfiction.__repo__
    + ")"
    + """ -->
<svg
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 19.2 23.04"
    version="1.1">
    <metadata>
        <rdf:RDF>
            <cc:Work rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
            </cc:Work>
        </rdf:RDF>
    </metadata>

<defs>
    <!-- lattice point -->
    <circle id="lattice_point" cx="0" cy="0" r="0.3"/>
    <!-- SiDB -->
    <circle id="sidb_color" cx="0" cy="0" r="0.9"/>
</defs>
 <!-- PATH_DEFINITION placeholder -->
    <rect x="0" y="0" width="19.2" height="23.04" style="fill:#ffffff;"/> <!-- Background rectangle placeholder -->
    <g>
        <use xlink:href="#lattice_point" x="3.84" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="7.68" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="9.93" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="15.36" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="3.84" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="7.68" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="11.52" y="17.61" style="fill:#6e7175;"/><use xlink:href="#lattice_point" x="15.36" y="17.61" style="fill:#6e7175;"/><use xlink:href="#sidb_color" x="3.84" y="7.68" style="fill:#00ADAE; fill-opacity:1; stroke:#00ADAE; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="7.68" style="fill:#ffffff; fill-opacity:0; stroke:#C8C8C8; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="7.68" y="9.93" style="fill:#00ADAE; fill-opacity:1; stroke:#00ADAE; stroke-width:0.3;"/><use xlink:href="#sidb_color" x="15.36" y="17.61" style="fill:#E34857; fill-opacity:1; stroke:#E34857; stroke-width:0.3;"/> <!-- SVG content placeholder -->
    </g>
</svg>"""
)


class TestWriteSvgLayout(unittest.TestCase):
    def test_write_sidb_cell_level_layout_to_svg(self):
        # Create and configure the SIDB layout
        sidb_layout = sidb_100_lattice((4, 4))
        sidb_layout.assign_cell_type((0, 0), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((1, 1), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((1, 0), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((3, 3), sidb_technology.cell_type.NORMAL)

        params = write_sidb_layout_svg_params()

        params.color_background = color_mode.DARK
        generated_svg_cell_level_dark_mode = write_sidb_layout_svg_to_string(sidb_layout, params)
        # print(generated_svg_cell_level_dark_mode)
        self.assertEqual(normalize_svg(generated_svg_cell_level_dark_mode), normalize_svg(cell_level_dark_mode))

        params.color_background = color_mode.LIGHT
        generated_svg_cell_level_light_mode = write_sidb_layout_svg_to_string(sidb_layout, params)
        print(cell_level_light_mode)
        self.assertEqual(normalize_svg(generated_svg_cell_level_light_mode), normalize_svg(cell_level_light_mode))

    def test_write_sidb_charge_distribution_to_svg(self):
        # Create and configure the SIDB layout
        sidb_layout = sidb_100_lattice((4, 4))
        sidb_layout.assign_cell_type((0, 0), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((1, 1), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((1, 0), sidb_technology.cell_type.NORMAL)
        sidb_layout.assign_cell_type((3, 3), sidb_technology.cell_type.NORMAL)

        cds = charge_distribution_surface_100(sidb_layout)
        cds.assign_charge_state((0, 0), sidb_charge_state.NEGATIVE)
        cds.assign_charge_state((1, 1), sidb_charge_state.NEGATIVE)
        cds.assign_charge_state((1, 0), sidb_charge_state.NEUTRAL)
        cds.assign_charge_state((3, 3), sidb_charge_state.POSITIVE)

        params = write_sidb_layout_svg_params()

        params.color_background = color_mode.DARK
        generated_svg_cds_dark_mode = write_sidb_layout_svg_to_string(cds, params)
        self.assertEqual(normalize_svg(generated_svg_cds_dark_mode), normalize_svg(cds_dark_mode))

        params.color_background = color_mode.LIGHT
        generated_svg_cds_light_mode = write_sidb_layout_svg_to_string(cds, params)
        self.assertEqual(normalize_svg(generated_svg_cds_light_mode), normalize_svg(cds_light_mode))


if __name__ == "__main__":
    unittest.main()
